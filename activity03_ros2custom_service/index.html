
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../activity02_ros2services/">
      
      
        <link rel="next" href="../activity04_ros2turtlesim/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Activity 4 - Ros2 Custom Services - Plantilla para Documentaci贸n</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ros2-custom-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Plantilla para Documentaci贸n" class="md-header__button md-logo" aria-label="Plantilla para Documentaci贸n" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Plantilla para Documentaci贸n
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Activity 4 - Ros2 Custom Services
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Plantilla para Documentaci贸n" class="md-nav__button md-logo" aria-label="Plantilla para Documentaci贸n" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Plantilla para Documentaci贸n
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inicio
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../comandos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comandos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejemplo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ejemplo
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitcmds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git Bash / Git
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examplesofrobots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework 1 - Robots by Morphology
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../activity01_ros2topics_nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Activity 1 - Ros2 Nodes and Topics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hw2_nomenclature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework 2 - Nomenclature
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fkmatrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Activity 2 - Forward Kinematics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../activity02_ros2services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Activity 3 - Ros2 Services
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Activity 4 - Ros2 Custom Services
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Activity 4 - Ros2 Custom Services
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        1) Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        2) Objectives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-previous-step-creating-the-service-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        3) Previous Step: Creating the Service Interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-first-code-led-panel-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        4) First Code: LED Panel (The Server)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-second-code-battery-node" class="md-nav__link">
    <span class="md-ellipsis">
      
        5) Second Code: Battery Node
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        6) Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-conclusions" class="md-nav__link">
    <span class="md-ellipsis">
      
        7) Conclusions
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../activity04_ros2turtlesim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Activity 5 - Ros2 Turtlesim Catch Them All
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        1) Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        2) Objectives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-previous-step-creating-the-service-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        3) Previous Step: Creating the Service Interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-first-code-led-panel-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        4) First Code: LED Panel (The Server)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-second-code-battery-node" class="md-nav__link">
    <span class="md-ellipsis">
      
        5) Second Code: Battery Node
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        6) Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-conclusions" class="md-nav__link">
    <span class="md-ellipsis">
      
        7) Conclusions
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="ros2-custom-services"> Ros2 Custom Services</h1>
<blockquote>
<p>In this assignment, I created a custom service interface and two nodes (Battery and LED Panel) that interact as a client-server.</p>
</blockquote>
<hr />
<h2 id="1-summary">1) Summary</h2>
<ul>
<li><strong>Homework Name:</strong> Ros2 Custom Services (Battery &amp; LED)</li>
<li><strong>Author:</strong> Angel Ivan Dominguez Cruz</li>
<li><strong>Subject:</strong> Applied Robotics</li>
<li><strong>Date:</strong> 19/02/2026</li>
</ul>
<hr />
<h2 id="2-objectives">2) Objectives</h2>
<ul>
<li><strong>General:</strong> Understand how to create custom service definitions in ROS 2 and implement a system where a Client node (Battery) controls a Server node (LED Panel).</li>
</ul>
<p align="center">
  <img src="https://docs.ros.org/en/foxy/_images/Service-MultipleServiceClient.gif" width="500">
</p>

<hr />
<h2 id="3-previous-step-creating-the-service-interface">3) Previous Step: Creating the Service Interface</h2>
<p>Before writing Python code, we needed to create a "common language" so the nodes could understand each other.</p>
<ol>
<li><strong>New Package:</strong> We created a package called <code>my_robot_interfaces</code> to hold the definitions.</li>
<li><strong>The .srv File:</strong> We created a file named <code>SetLed.srv</code> with this structure:<ul>
<li><strong>Request:</strong> <code>int64 led_number</code> and <code>bool state</code>.</li>
<li><strong>Response:</strong> <code>bool success</code>.</li>
</ul>
</li>
<li><strong>Compilation:</strong> We modified <code>CMakeLists.txt</code> and <code>package.xml</code> to generate the code. Finally, we compiled it using <code>colcon build</code>.</li>
</ol>
<p>Now, both nodes can import <code>SetLed</code> to communicate.</p>
<hr />
<h2 id="4-first-code-led-panel-the-server">4) First Code: LED Panel (The Server)</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>import<span class="w"> </span>rclpy
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>from<span class="w"> </span>rclpy.node<span class="w"> </span>import<span class="w"> </span>Node
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>from<span class="w"> </span>my_robot_interfaces.srv<span class="w"> </span>import<span class="w"> </span>SetLed
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>from<span class="w"> </span>std_msgs.msg<span class="w"> </span>import<span class="w"> </span>Int64MultiArray
</span></code></pre></div>
<ul>
<li><strong>Libraries:</strong> The code starts by importing the necessary libraries. It imports rclpy, Node, the custom service SetLed (to receive orders) and the message Int64MultiArray to publish the list of LED states.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>class<span class="w"> </span>LedPanelNode<span class="o">(</span>Node<span class="o">)</span>:
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span>super<span class="o">()</span>.__init__<span class="o">(</span><span class="s2">&quot;led_panel&quot;</span><span class="o">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">        </span>self.led_states_<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">        </span>self.publisher_<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_publisher<span class="o">(</span>Int64MultiArray,<span class="w"> </span><span class="s2">&quot;led_panel_state&quot;</span>,<span class="w"> </span><span class="m">10</span><span class="o">)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">        </span>self.timer_<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_timer<span class="o">(</span><span class="m">1</span>.0,<span class="w"> </span>self.publish_led_states<span class="o">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span>self.server_<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_service<span class="o">(</span>SetLed,<span class="w"> </span><span class="s2">&quot;set_led&quot;</span>,<span class="w"> </span>self.callback_set_led<span class="o">)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span><span class="s2">&quot;LED panel initialized&quot;</span><span class="o">)</span>
</span></code></pre></div>
<ul>
<li><strong>Class LedPanelNode:</strong> In this section, the node class is defined. The node is named "led_panel". It initializes a list [0, 0, 0] representing the 3 LEDs off. It creates a publisher to broadcast this status every second to the "led_panel_state" topic. Finally, it creates a Service Server named "set_led" that uses the SetLed type to wait for requests.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">    </span>def<span class="w"> </span>publish_led_states<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">        </span><span class="nv">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Int64MultiArray<span class="o">()</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">        </span>msg.data<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.led_states_<span class="w"> </span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span>self.publisher_.publish<span class="o">(</span>msg<span class="o">)</span>
</span></code></pre></div>
<ul>
<li><strong>Publish Callback:</strong> This function runs every second controlled by the timer. It creates an Int64MultiArray message, assigns the current list of LEDs to it, and publishes it.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">    </span>def<span class="w"> </span>callback_set_led<span class="o">(</span>self,<span class="w"> </span>request,<span class="w"> </span>response<span class="o">)</span>:
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">        </span><span class="c1"># request.led_number: LED number (1, 2 or 3)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="c1"># request.state: True (on) o False (off)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="nv">led_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>request.led_number<span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1">#for the index</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span>led_index<span class="w"> </span>&lt;<span class="w"> </span>len<span class="o">(</span>self.led_states_<span class="o">)</span>:
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">            </span>self.led_states_<span class="o">[</span>led_index<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="k">if</span><span class="w"> </span>request.state<span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">            </span>response.success<span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">            </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span>f<span class="s2">&quot;LED {request.led_number} changing to {request.state}&quot;</span><span class="o">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">        </span><span class="k">else</span>:
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">            </span>response.success<span class="w"> </span><span class="o">=</span><span class="w"> </span>False
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">            </span>self.get_logger<span class="o">()</span>.error<span class="o">(</span><span class="s2">&quot;Invalid number of LED&quot;</span><span class="o">)</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>response
</span></code></pre></div>
<ul>
<li><strong>Service Logic:</strong> This is the main logic of the server. When the Battery node sends a request, this function converts the LED number to an index. It checks if the LED number is valid (1, 2, or 3). If it is valid, it updates the internal list (1 for True, 0 for False) and sends a "Success" response. If invalid, it sends a failure response.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>def<span class="w"> </span>main<span class="o">(</span><span class="nv">args</span><span class="o">=</span>None<span class="o">)</span>:
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span>rclpy.init<span class="o">(</span><span class="nv">args</span><span class="o">=</span>args<span class="o">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nv">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LedPanelNode<span class="o">()</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span>rclpy.spin<span class="o">(</span>node<span class="o">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span>rclpy.shutdown<span class="o">()</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">if</span><span class="w"> </span><span class="nv">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span>:
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span>main<span class="o">()</span>
</span></code></pre></div>
<ul>
<li>
<p><strong>Main Execution:</strong> The main function initializes the ROS2 communication (rclpy.init), creates an instance of the class, and uses rclpy.spin to keep the node running and listening for callbacks until the program is manually stopped. Finally, it shuts down the ROS 2 client library cleanly.</p>
</li>
<li>
<p><strong>Full Code:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>import<span class="w"> </span>rclpy
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>from<span class="w"> </span>rclpy.node<span class="w"> </span>import<span class="w"> </span>Node
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>from<span class="w"> </span>my_robot_interfaces.srv<span class="w"> </span>import<span class="w"> </span>SetLed
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>from<span class="w"> </span>std_msgs.msg<span class="w"> </span>import<span class="w"> </span>Int64MultiArray
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>class<span class="w"> </span>LedPanelNode<span class="o">(</span>Node<span class="o">)</span>:
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span>super<span class="o">()</span>.__init__<span class="o">(</span><span class="s2">&quot;led_panel&quot;</span><span class="o">)</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span>self.led_states_<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span>self.publisher_<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_publisher<span class="o">(</span>Int64MultiArray,<span class="w"> </span><span class="s2">&quot;led_panel_state&quot;</span>,<span class="w"> </span><span class="m">10</span><span class="o">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span>self.timer_<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_timer<span class="o">(</span><span class="m">1</span>.0,<span class="w"> </span>self.publish_led_states<span class="o">)</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span>self.server_<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_service<span class="o">(</span>SetLed,<span class="w"> </span><span class="s2">&quot;set_led&quot;</span>,<span class="w"> </span>self.callback_set_led<span class="o">)</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">        </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span><span class="s2">&quot;Panel LED iniciado (Esperando 贸rdenes...)&quot;</span><span class="o">)</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span>def<span class="w"> </span>publish_led_states<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="nv">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Int64MultiArray<span class="o">()</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">        </span>msg.data<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.led_states_
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span>self.publisher_.publish<span class="o">(</span>msg<span class="o">)</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">    </span>def<span class="w"> </span>callback_set_led<span class="o">(</span>self,<span class="w"> </span>request,<span class="w"> </span>response<span class="o">)</span>:
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">        </span><span class="nv">led_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>request.led_number<span class="w"> </span>-<span class="w"> </span><span class="m">1</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span>led_index<span class="w"> </span>&lt;<span class="w"> </span>len<span class="o">(</span>self.led_states_<span class="o">)</span>:
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">            </span>self.led_states_<span class="o">[</span>led_index<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="k">if</span><span class="w"> </span>request.state<span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">            </span>response.success<span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">            </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span>f<span class="s2">&quot;LED {request.led_number} cambiado a {request.state}&quot;</span><span class="o">)</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">        </span><span class="k">else</span>:
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">            </span>response.success<span class="w"> </span><span class="o">=</span><span class="w"> </span>False
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">            </span>self.get_logger<span class="o">()</span>.error<span class="o">(</span><span class="s2">&quot;N煤mero de LED inv谩lido&quot;</span><span class="o">)</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>response
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>def<span class="w"> </span>main<span class="o">(</span><span class="nv">args</span><span class="o">=</span>None<span class="o">)</span>:
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">    </span>rclpy.init<span class="o">(</span><span class="nv">args</span><span class="o">=</span>args<span class="o">)</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="w">    </span><span class="nv">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LedPanelNode<span class="o">()</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="w">    </span>rclpy.spin<span class="o">(</span>node<span class="o">)</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="w">    </span>rclpy.shutdown<span class="o">()</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="k">if</span><span class="w"> </span><span class="nv">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span>:
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">    </span>main<span class="o">()</span>
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h2 id="5-second-code-battery-node">5) Second Code: Battery Node</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>import<span class="w"> </span>rclpy
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>from<span class="w"> </span>rclpy.node<span class="w"> </span>import<span class="w"> </span>Node
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>from<span class="w"> </span>my_robot_interfaces.srv<span class="w"> </span>import<span class="w"> </span>SetLed
</span></code></pre></div>
<ul>
<li><strong>Libraries:</strong> We import rclpy, Node, and the same custom service SetLed. This time, we use the service definition to send requests (as a client).</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>class<span class="w"> </span>BatteryNode<span class="o">(</span>Node<span class="o">)</span>:
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span>super<span class="o">()</span>.__init__<span class="o">(</span><span class="s2">&quot;battery_node&quot;</span><span class="o">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span>self.battery_full<span class="w"> </span><span class="o">=</span><span class="w"> </span>True<span class="w"> </span><span class="c1">#Starting with a full battery</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">        </span>self.counter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span>self.create_timer<span class="o">(</span><span class="m">1</span>.0,<span class="w"> </span>self.check_battery<span class="o">)</span><span class="c1">#1 second timer</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span><span class="s2">&quot;Bater铆a iniciada.&quot;</span><span class="o">)</span>
</span></code></pre></div>
<ul>
<li><strong>Node Initialization:</strong> The node starts with a "full" battery status and a counter variable at 0. It creates a timer that triggers the check_battery function every second to simulate the battery life cycle.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">    </span>def<span class="w"> </span>check_battery<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">        </span>self.counter<span class="w"> </span>+<span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>self.battery_full:
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>self.counter<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">4</span>:#it<span class="w"> </span>enters<span class="w"> </span>after<span class="w"> </span><span class="m">4</span><span class="w"> </span>seconds<span class="w"> </span>of<span class="w"> </span>being<span class="w"> </span>full
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">                </span>self.get_logger<span class="o">()</span>.warn<span class="o">(</span><span class="s2">&quot;Empty Battery!&quot;</span><span class="o">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">                </span>self.battery_full<span class="w"> </span><span class="o">=</span><span class="w"> </span>False<span class="w"> </span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">                </span>self.counter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">                </span>self.call_led_service<span class="o">(</span><span class="m">3</span>,<span class="w"> </span>True<span class="o">)</span><span class="c1">#turn on LED 3 when battery is empty</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">        </span><span class="k">else</span>:
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>self.counter<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">6</span>:
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">                </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span><span class="s2">&quot;Full Battery!&quot;</span><span class="o">)</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">                </span>self.battery_full<span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">                </span>self.counter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">                </span>self.call_led_service<span class="o">(</span><span class="m">3</span>,<span class="w"> </span>False<span class="o">)</span><span class="c1">#turn off LED 3 when battery is full</span>
</span></code></pre></div>
<ul>
<li><strong>Battery Logic:</strong> This function simulates the battery draining. It increments a counter every second. After 4 seconds, if the battery was full, it sets it to empty and calls the service to Turn On LED 3. After 6 seconds, if the battery was empty, it sets it to full and calls the service to Turn Off LED 3.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">    </span>def<span class="w"> </span>call_led_service<span class="o">(</span>self,<span class="w"> </span>led_number,<span class="w"> </span>state<span class="o">)</span>:
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">        </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_client<span class="o">(</span>SetLed,<span class="w"> </span><span class="s2">&quot;set_led&quot;</span><span class="o">)</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span>not<span class="w"> </span>client.wait_for_service<span class="o">(</span><span class="m">1</span>.0<span class="o">)</span>:
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">            </span>self.get_logger<span class="o">()</span>.warn<span class="o">(</span><span class="s2">&quot;Waiting service...&quot;</span><span class="o">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="nv">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SetLed.Request<span class="o">()</span><span class="w"> </span><span class="c1">#request object for the service (led_number and state)</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span>request.led_number<span class="w"> </span><span class="o">=</span><span class="w"> </span>led_number
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span>request.state<span class="w"> </span><span class="o">=</span><span class="w"> </span>state
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span>client.call_async<span class="o">(</span>request<span class="o">)</span>
</span></code></pre></div>
<ul>
<li><strong>Service Call:</strong> This is where the client communicates with the server. It creates a client for the "set_led" service and waits until the LED Panel service is available. It creates a "request object" filling in the led_number (3) and the state (True/False). It sends the request asynchronously (call_async) so the battery timer keeps working without freezing while waiting for a response.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>def<span class="w"> </span>main<span class="o">(</span><span class="nv">args</span><span class="o">=</span>None<span class="o">)</span>:
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span>rclpy.init<span class="o">(</span><span class="nv">args</span><span class="o">=</span>args<span class="o">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nv">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>BatteryNode<span class="o">()</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span>rclpy.spin<span class="o">(</span>node<span class="o">)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span>rclpy.shutdown<span class="o">()</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">if</span><span class="w"> </span><span class="nv">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span>:
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span>main<span class="o">()</span>
</span></code></pre></div>
<ul>
<li>
<p><strong>Main Execution:</strong> The main function initializes ROS2, creates node object, and spins it to keep it active. This ensures the node stays alive to process service requests, subscriptions, and timer callbacks until the user stops the program.</p>
</li>
<li>
<p><strong>Full Code:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>import<span class="w"> </span>rclpy
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>from<span class="w"> </span>rclpy.node<span class="w"> </span>import<span class="w"> </span>Node
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>from<span class="w"> </span>my_robot_interfaces.srv<span class="w"> </span>import<span class="w"> </span>SetLed
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>class<span class="w"> </span>BatteryNode<span class="o">(</span>Node<span class="o">)</span>:
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span>super<span class="o">()</span>.__init__<span class="o">(</span><span class="s2">&quot;battery_node&quot;</span><span class="o">)</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span>self.battery_full<span class="w"> </span><span class="o">=</span><span class="w"> </span>True<span class="w"> </span><span class="c1">#Starting with a full battery</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span>self.counter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">        </span>self.create_timer<span class="o">(</span><span class="m">1</span>.0,<span class="w"> </span>self.check_battery<span class="o">)</span><span class="c1">#1 second timer</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">        </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span><span class="s2">&quot;Bater铆a iniciada.&quot;</span><span class="o">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span>def<span class="w"> </span>check_battery<span class="o">(</span>self<span class="o">)</span>:
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">        </span>self.counter<span class="w"> </span>+<span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>self.battery_full:
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>self.counter<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">4</span>:#it<span class="w"> </span>enters<span class="w"> </span>after<span class="w"> </span><span class="m">4</span><span class="w"> </span>seconds<span class="w"> </span>of<span class="w"> </span>being<span class="w"> </span>full
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">                </span>self.get_logger<span class="o">()</span>.warn<span class="o">(</span><span class="s2">&quot;Empty Battery!&quot;</span><span class="o">)</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">                </span>self.battery_full<span class="w"> </span><span class="o">=</span><span class="w"> </span>False<span class="w"> </span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">                </span>self.counter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">                </span>self.call_led_service<span class="o">(</span><span class="m">3</span>,<span class="w"> </span>True<span class="o">)</span><span class="c1">#turn on LED 3 when battery is empty</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">        </span><span class="k">else</span>:
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>self.counter<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">6</span>:
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">                </span>self.get_logger<span class="o">()</span>.info<span class="o">(</span><span class="s2">&quot;Full Battery!&quot;</span><span class="o">)</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">                </span>self.battery_full<span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="w">                </span>self.counter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">                </span>self.call_led_service<span class="o">(</span><span class="m">3</span>,<span class="w"> </span>False<span class="o">)</span><span class="c1">#turn off LED 3 when battery is full</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">    </span>def<span class="w"> </span>call_led_service<span class="o">(</span>self,<span class="w"> </span>led_number,<span class="w"> </span>state<span class="o">)</span>:
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">        </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.create_client<span class="o">(</span>SetLed,<span class="w"> </span><span class="s2">&quot;set_led&quot;</span><span class="o">)</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span>not<span class="w"> </span>client.wait_for_service<span class="o">(</span><span class="m">1</span>.0<span class="o">)</span>:
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">            </span>self.get_logger<span class="o">()</span>.warn<span class="o">(</span><span class="s2">&quot;Waiting service...&quot;</span><span class="o">)</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="w">        </span><span class="nv">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SetLed.Request<span class="o">()</span><span class="w"> </span><span class="c1">#request object for the service (led_number and state)</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">        </span>request.led_number<span class="w"> </span><span class="o">=</span><span class="w"> </span>led_number
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="w">        </span>request.state<span class="w"> </span><span class="o">=</span><span class="w"> </span>state
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="w">        </span>client.call_async<span class="o">(</span>request<span class="o">)</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>def<span class="w"> </span>main<span class="o">(</span><span class="nv">args</span><span class="o">=</span>None<span class="o">)</span>:
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="w">    </span>rclpy.init<span class="o">(</span><span class="nv">args</span><span class="o">=</span>args<span class="o">)</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="w">    </span><span class="nv">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>BatteryNode<span class="o">()</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="w">    </span>rclpy.spin<span class="o">(</span>node<span class="o">)</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="w">    </span>rclpy.shutdown<span class="o">()</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="k">if</span><span class="w"> </span><span class="nv">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span>:
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="w">    </span>main<span class="o">()</span>
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h2 id="6-results">6) Results</h2>
<p><img alt="First Node" src="../recursos/imgs/ros2battery/led_panel.jpeg" />
<img alt="Second Node" src="../recursos/imgs/ros2battery/battery.jpeg" />
<img alt="Topic Listener" src="../recursos/imgs/ros2battery/led_echo.jpg" /></p>
<hr />
<h2 id="7-conclusions">7) Conclusions</h2>
<ul>
<li><strong>General:</strong> This exercise demonstrated how to create a custom communication interface using .srv files. We successfully implemented a Server (LED Panel) that listens for commands and publishes its status, and a Client (Battery) that makes decisions based on time and sends orders to the server. The Client uses asynchronous calls to ensure the timing logic isn't interrupted while waiting for the server.</li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.tooltips"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>